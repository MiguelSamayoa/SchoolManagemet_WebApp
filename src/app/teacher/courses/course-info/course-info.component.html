
<div class="absolute inset-0"  *ngIf="isLoading">
  <div class="flex items-center justify-center h-full z-10">
    <span class="loading loading-spinner loading-lg"></span>
  </div>
</div>

<dialog id="ActivityModal" class="modal">
  <div class="modal-box">
    <h3 class="text-lg font-bold">Seguro?</h3>
    <p class="py-4">Esta seguro que desea eliminar la actividad? </p>
    <div class="modal-action">
      <form method="dialog">
        <!-- if there is a button in form, it will close the modal -->
        <button class="btn btn-neutral m-2 p-2">
          Cancelar
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 p-0">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
          </svg>
        </button>

        <button (click)="EliminarActividad( ) " class="btn btn-error text-base-100 m-2 p-2">
          Eliminar
        </button>
      </form>
    </div>
  </div>
</dialog>

<dialog id="aprobacionModal" class="modal">
  <div class="modal-box">
    <h3 class="text-lg font-bold">Seguro?</h3>
    <strong class="py-4">Esta seguro que desea solicitar aprobacion? </strong>
    <p class="text-info">Esto bloqueara la modificacion de notas</p>
    <div class="modal-action">
      <form method="dialog">
        <!-- if there is a button in form, it will close the modal -->
        <button class="btn btn-neutral m-2 p-2" (click)="SolicitarAprobacion()">
          Solicitar Aprobaci√≥n
        </button>

        <button  class="btn btn-error text-base-100 m-2 p-2">
          Cancelar
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6 p-0">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
          </svg>
        </button>
      </form>
    </div>
  </div>
</dialog>

<activity-form
[isOpen]="isActivityFormModalOpen"
(modalClose)="handleActivityModalClose()"
(Created)="handleCreated($event)"
[isCreate]="isCreatingActivity"
[Activity]="SelectedToEdit">
</activity-form>

<div class="flex flex-col w-full h-full">

  <!-- Informacion del alumno -->
  <div class="flex flex-col h-auto w-full">
    <div class="card bg-base-300 h-full shadow-xl">
      <div class="card-body flex flex-row py-3" *ngIf="Curso">

        <div class="flex flex-1 m-2 justify-between align-center">
          <div>
            <strong class="mx-5" *ngIf="Curso.course" > {{Curso.course.courseName}}.</strong> <strong class="mx-5"> {{Curso.grade.grade.gradeName}} - {{Curso.grade.year}}-{{Curso.grade.section}}</strong>
          </div>
          <div>
            <strong class="badge badge-primary hover:badge-secondary hover:badge-outline badge-outline p-5 cursor-pointer	" onclick="aprobacionModal.showModal()" *ngIf="ModuloActivo().state.stateId == 2"> Solicitar aprobacion </strong>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Menu -->
  <ul class="menu menu-horizontal ml-2 mt-5 w-full rounded-box p-0">
    <li (click)="tab = 'Alumnos'" class="rounded-t-lg" [ngClass]="tab == 'Alumnos'?'bg-base-300':'bg-base-100'"><a>Notas</a></li>
    <li (click)="tab = 'Actividades'" class="rounded-t-lg" [ngClass]="tab == 'Actividades'?'bg-base-300':'bg-base-100'"><a>Actividades</a></li>
  </ul>

  <!-- Actividades -->
  <div *ngIf="tab == 'Actividades'" class="bg-base-300 rounded-box h-auto overflow-x-auto">
    <div class="card w-full h-auto shadow-xl">
      <div class="card-body text-lg flex py-5 h-auto 	" *ngFor="let modulo of Curso?.modules; let i = index">

        <div class="collapse bg-base-100">
          <input type="checkbox" [checked]="IsActivo(modulo)"/>
          <div class="collapse-title font-medium flex justify-between">
            Modulo {{i + 1}}
            <div> {{modulo.state.state}} </div>
          </div>
          <div class="collapse-content flex">
            <table
              class="table table-zebra transition-all duration-500 border-collapse	"
              [ngClass]="{ 'w-1/2': actividadIdToView!=0, 'w-full': actividadIdToView==0, 'ml-0': actividadIdToView!=0 }" >
              <thead>
                <tr>
                  <th class="">Fecha de Entrega</th>
                  <th class="">Actividad</th>
                  <th class="text-center">Nota</th>
                  <th class="text-center">
                    <div
                      *ngIf="modulo.state.stateId != 3"
                      class="w-20 badge badge-success badge-outline cursor-pointer"
                      onclick="isCreatingActivity = true"
                      (click)="openActivityModal(modulo.moduleId)" >
                        Crear
                    </div>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let actividad of ordenarActividades(modulo.activities)">
                  <td class="">{{ actividad.deadline | date:'dd/MM/yyyy' }}</td>
                  <td class="">{{ actividad.activityName }}</td>
                  <td class="text-center">{{ actividad.maxScore }}</td>
                  <td class="text-center" *ngIf="actividadIdToView != actividad.activityId">
                    <div class="w-20 badge badge-primary hover:badge-secondary hover:badge-outline badge-outline badge-outline cursor-pointer" (click)="selectActividad(actividad.activityId)" >
                      Ver
                    </div>
                    <div class="w-20 mx-2 badge badge-error badge-outline cursor-pointer"
                     *ngIf="modulo.state.stateId != 3"
                     (click)=" activityToDelete = actividad.activityId"
                     onclick="ActivityModal.showModal()">
                      Eliminar
                    </div>
                  </td>
                  <td class="text-center" *ngIf="actividadIdToView == actividad.activityId">
                    <div class="w-20 badge badge-primary hover:badge-secondary hover:badge-outline badge-outline cursor-pointer" (click)="selectActividad(actividad.activityId)" *ngIf="actividadIdToView == actividad.activityId">
                      Cancelar
                    </div>
                    <div class="w-20 mx-2 badge badge-error badge-outline cursor-pointer"
                     *ngIf="modulo.state.stateId != 3"
                     (click)=" activityToDelete = actividad.activityId"
                     onclick="ActivityModal.showModal()">
                      Eliminar
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>

            <div *ngIf="modulo.activities.length > 0 && actividadIdToView!=0" class="transition-all duration-500 flex flex-col w-1/3 mx-auto">
              <h2 class="font-medium">
                <strong> {{ActividadToView(modulo, actividadIdToView)?.activityName}} </strong>
              </h2>
              <p class="mt-5">
                {{ActividadToView(modulo, actividadIdToView)?.description}}
              </p>

              <div class="text-info flex justify-between">
                <div>Fecha de Entrega {{ActividadToView(modulo, actividadIdToView)?.deadline | date:'dd/MM/yyyy' }}</div>
                <div
                  class="w-20 badge badge-primary hover:badge-secondary hover:badge-outline badge-outline badge-outline cursor-pointer"
                  *ngIf="modulo.state.stateId != 3"
                  onclick="isCreatingActivity = false;"
                  (click)="openActivityModal(modulo.moduleId, ActividadToView(modulo, actividadIdToView))">
                  Editar
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- Alumnos -->
  <div *ngIf="tab == 'Alumnos'" class="bg-base-300 rounded-box h-auto overflow-x-auto">
    <div class="card w-full  h-auto shadow-xl">
      <div class="card-body text-lg flex py-5">
        <div class="card-title mb-3 w-full justify-around" *ngIf="Curso && ModuleToViewNotes">

          <div class="opacity-25" *ngIf="Curso.modules.indexOf( ModuleToViewNotes ) == 0">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-9">
              <path stroke-linecap="round" stroke-linejoin="round" d="m11.25 9-3 3m0 0 3 3m-3-3h7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>
          </div>
          <div *ngIf="Curso.modules.indexOf(ModuleToViewNotes ) !== 0" (click)="prevModulo()" >
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-9">
              <path stroke-linecap="round" stroke-linejoin="round" d="m11.25 9-3 3m0 0 3 3m-3-3h7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>
          </div>

          <div>Modulo {{ Curso.modules.indexOf( ModuleToViewNotes ) +1}} - {{ModuleToViewNotes.state.state}} </div>

          <div class="opacity-25" *ngIf="Curso.modules.indexOf( ModuleToViewNotes ) == Curso.modules.length-1">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-9">
              <path stroke-linecap="round" stroke-linejoin="round" d="m12.75 15 3-3m0 0-3-3m3 3h-7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>
          </div>
          <div *ngIf="Curso.modules.indexOf( ModuleToViewNotes ) < Curso.modules.length-1" (click)="nextModulo()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="#09090b" class="size-9">
              <path stroke-linecap="round" stroke-linejoin="round" d="m12.75 15 3-3m0 0-3-3m3 3h-7.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>
          </div>
        </div>
        <notas-table
          [students]="Estudiantes"
          [module]="ModuleToViewNotes"
        ></notas-table>
      </div>
    </div>
  </div>
</div>
